version: v1.0

name: ðŸš€ Deploy Staging & Production

agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

auto_cancel:
  queued:
    when: "branch =~ 'releases'"

blocks:
  - name: ðŸš€ Deploy to Production
    dependencies: []
    task:
      jobs:
        - name: success
          commands:
            - exit 0
  - name: ðŸš€ Deploy to Staging
    dependencies: []
    task:
      jobs:
        - name: failure
          commands:
            - exit 1
  
  - name: Send status update
    dependencies: ["ðŸš€ Deploy to Staging", "ðŸš€ Deploy to Production"]
    task:
      epilogue:
        on_pass:
          commands:
            - echo "This command runs if job has passed"
        on_fail:
          commands:
            - echo "This command runs if job has failed"
      jobs: []

promotions:
  - name: ðŸš€ Deploy to Demo
    pipeline_file: deploy-demo.yml
